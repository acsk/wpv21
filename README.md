<p># wapi-autov0620 api integra&ccedil;&atilde;o wapp 06/2020 (upgrade).</p>
<p>INTRODU&Ccedil;&Atilde;O<br>&nbsp; &nbsp; Este documento tem por intuito, apresentar de forma did&aacute;tica as funcionalidades de ferramenta de integra&ccedil;&atilde;o de messenger(WP), atrav&eacute;s da utiliza&ccedil;&atilde;o de comunica&ccedil;&atilde;o via api, a seguem os t&oacute;picos que s&atilde;o abordados:</p>
<p>‚úÖ 1. Criar nova Inst&acirc;ncia;<br>‚úÖ 2. Enviar Mensagem (texto);<br>‚úÖ 3. Enviar Arquivo<br>‚úÖ 4. Verificar Status da inst&acirc;ncia;<br>‚úÖ 5. Listar Contatos de uma inst&acirc;ncia;<br>‚úÖ 6. Listar Conversas por Contato;<br>‚úÖ 7. Listar Todas as Mensagens n&atilde;o lidas;<br>‚úÖ 8. &nbsp; &nbsp;Retornar Nova mensagem na Inst&acirc;ncia;</p>
<p>‚úÖ 9. &nbsp; &nbsp;üÜïCheckar n&uacute;mero (perfil wp);<br>‚úÖ 10. &nbsp; &nbsp;Desconectar uma inst&acirc;ncia;</p>
<p>Testes:<br>Para realizar testes pode utilizar servidor: http://144.217.207.169:3000</p>
<p>Exemplo de uso:<br>http://144.217.207.169:3000/wp/qrcode<br>Requisi&ccedil;&otilde;es via POST<br>&nbsp; &nbsp; Seguem abaixo os par&acirc;metros e exemplos de uso.</p>
<p>Para realizar testes de aquisi&ccedil;&otilde;es pode ser utilizado o POSTMAN (ferramenta para testes de requisi&ccedil;&otilde;es de api: Download Postman</p>
<p>A api &eacute; desenvolvida utilizando nodejs, utilizando como padr&atilde;o a porta 3000 (customiz&aacute;vel do ponto de vista t&eacute;cnico).</p>
<p>Exemplo de uso utilizando um servidor local:</p>
<p>&nbsp;http://localhost:3000/wp/qrcode</p>
<p>üë®&zwj;üè´ FUNCIONALIDADES: üë©&zwj;üíª</p>
<p>1. &nbsp; &nbsp;CRIAR NOVA INST&Acirc;NCIA<br>Gerar Qrcode - Criar nova inst&acirc;ncia<br><strong>&nbsp;Fun&ccedil;&atilde;o:</strong> /wp/qrcode<br><strong>Descri&ccedil;&atilde;o:</strong> Recebe a requisi&ccedil;&atilde;o para criar nova inst&acirc;ncia do WP,<br><br><strong>Exemplo:</strong> Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#A52A2A;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(instancia criada): &nbsp;informa&ccedil;&otilde;es sobre cria&ccedil;&atilde;o ou informar caso a instancia j&aacute; existe e o status da mesma.<br>Obs: o codigo qrcode tem validade de 15 segundos, sendo necess&aacute;rio nova consulta para atualizar o novo c&oacute;digo.<br><span style="color:#006400;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;qrcode&quot;: &quot;ZXRlIOkgdW0gdGVzdGUgZGUgcmVxdWlzaefjbyBhcGkgd2hhdHNhcHAgZnVuY2lvbmFsLCBwYXJh<br> YmVucyBwZWxhIGFxdWlzaefjbw0K&quot;,<br> &quot;status&quot;: &ldquo;UNPAIRED&rdquo;<br>&nbsp;}</span><br>obs.: enquanto o retorno exibir o c&oacute;digo qrcode, &eacute; necess&aacute;rio consultar novamente ap&oacute;s a sincroniza&ccedil;&atilde;o do qrcode. O resultado ap&oacute;s o sincronismo veja a seguir...</p>
<p>retorno (caso a inst&acirc;ncia j&aacute; exista):<br><span style="color:#0000CD;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;qrcode&quot;: &quot;Synchronized&quot;,<br> &quot;status&quot;: &ldquo;CONNECTED&rdquo;<br>&nbsp;}</span></p>
<p>2. &nbsp; &nbsp;ENVIAR MENSAGEM SIMPLES (TEXTO)<br>Fun&ccedil;&atilde;o: /wp/sendMsg<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;,<br> &quot;number&quot;:&quot;5516997141457@c.us&quot;,<br> &quot;msg&quot;:&quot;üëãOl&aacute;, segue sua fatura ref. mes 04/2020. \n link da fatura: https://www.ficticio.com.br/app/public/Admin/relatorio/fatura=FAT042020&quot;<br>&nbsp;}</span></p>
<p><span style="color:#0000CD;">Retorno: Caso haja erro a fun&ccedil;&atilde;o retornar&aacute; false.<br> {<br> &quot;status&quot;: true<br>&nbsp;}</span></p>
<p>&nbsp;</p>
<p>3. &nbsp; &nbsp;ENVIAR ARQUIVO:<br>Fun&ccedil;&atilde;o: /wp/sendMedia<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;,<br> &quot;number&quot;:&quot;5516997141457@c.us&quot;,<br> &quot;msg&quot;:&quot;üëãOl&aacute;, segue arquivo de sua fatura ref. mes 04/2020.&quot;,<br> &quot;tipo&quot;:&quot;FATURA-FTR0098938838992020.docx&quot;,<br> &ldquo;arquivo&rdquo;:&rdquo;UEsDBBQABgAIAAAAIQAwySgMcgEAAKUFAAATAAgCW0NvbnRlbnRfVHlw==&rdquo;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado &nbsp;valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) &nbsp;e retorno (true mensagem enviada ou false se a mensagem n&atilde;o for enviada):<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;status&quot;: &ldquo;CONNECTED&rdquo;,<br> &ldquo;retorno&rdquo;:true<br>&nbsp;}</span><br>4. VERIFICAR STATUS DA INSTANCIA (CRIADA ANTERIORMENTE)<br>Fun&ccedil;&atilde;o: /wp/status<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) :<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;status&quot;: &ldquo;UNPAIRED&rdquo;<br>&nbsp;}</span></p>
<p>5. &nbsp; &nbsp;LISTAR CONTATOS DE UMA INST&Acirc;NCIA:<br>Fun&ccedil;&atilde;o: /wp/getAllContacts<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) &nbsp;e contatos com os dados dos contatos resgatados:<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;contatos&quot;: [{...}]<br>&nbsp;}</span></p>
<p><br>6. LISTAR CONVERSAS POR CONTATO:<br>Fun&ccedil;&atilde;o: /wp/get_AllMsgs<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;,<br> &quot;number&quot;:&quot;556392320847@c.us&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) :<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;webhook&quot;: [{...}]<br>&nbsp;}</span></p>
<p>7. &nbsp; &nbsp;LISTAR TODAS AS MENSAGENS N&Atilde;O LIDAS:<br>Fun&ccedil;&atilde;o: /wp/getUnreadMsg<br>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject):<br><span style="color:#006400;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) :<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;msgs&quot;: [],<br> &quot;status&quot;: &ldquo;UNPAIRED&rdquo;<br>&nbsp;}</span><br>Obs.: Dentro do arrayObject msgs:[] &nbsp;ser&aacute; retornado todos os dados de mensagens n&atilde;o lidas tais como dados da mensagen, contato, horarios, etc&hellip;</p>
<p>8. &nbsp; &nbsp;RETORNAR NOVA MENSAGEM NA INST&Acirc;NCIA:<br>Fun&ccedil;&atilde;o: /wp/newMsg<br>&nbsp; &nbsp; Descri&ccedil;&atilde;o: retornar &uacute;ltima nova mensagem recebida e n&atilde;o lida.</p>
<p>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject): &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br><span style="color:#2F4F4F;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) hook exibir&aacute; os dados de novas mensagens via arrayObject (matriz):<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;hook&quot;: {...}<br>&nbsp;}</span></p>
<p>&nbsp;</p>
<p>9. CHECKAR N&Uacute;MERO &nbsp;(WP):&lt;br&gt;<br>Fun&ccedil;&atilde;o: /wp/check_number<br>&nbsp; &nbsp; Descri&ccedil;&atilde;o: Informa dados de um n&uacute;mero pertencente a instancia, inclusive se &eacute; um n&uacute;mero v&aacute;lido.</p>
<p>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject): &nbsp; &nbsp; &nbsp; &nbsp;<br>{<br>&quot;instancia&quot;:&quot;vendas-001&quot;,<br>&quot;number&quot;:&quot;5516997141457@c.us&quot;<br>}</p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) :</p>
<p>{&quot;instancia&quot;:&quot;vendas-001&quot;,&quot;retorno&quot;:{&quot;id&quot;: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {&quot;server&quot;:&quot;c.us&quot;,&quot;user&quot;:&quot;5516997141457&quot;,&quot;_serialized&quot;:&quot;5516997141457@c.us&quot;},&quot;status&quot;:200,&quot;isBusiness&quot;:true,&quot;canReceiveMessage&quot;:true,&quot;numberExists&quot;:true}</p>
<p>}</p>
<p>se o n&uacute;mero for invalido ou inexsitente retronar&aacute;:</p>
<p><span style='color: rgb(0, 0, 0); font-family: "Times New Roman"; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'>{</span></p>
<p><span style='color: rgb(0, 0, 0); font-family: "Times New Roman"; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'>&quot;instancia&quot;:&quot;vendas-001&quot;,</span></p>
<p><span style='color: rgb(0, 0, 0); font-family: "Times New Roman"; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'>&quot;retorno&quot;:false</span></p>
<p><span style='color: rgb(0, 0, 0); font-family: "Times New Roman"; font-size: medium; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'>}</span> </p>
<p><br>10. DESCONECTAR UMA SESS&Atilde;O (INSTANCIA):&lt;br&gt;<br>Fun&ccedil;&atilde;o: /wp/logoff<br>&nbsp; &nbsp; Descri&ccedil;&atilde;o: desconectar e remover a sess&atilde;o da atividade na api(sistema).</p>
<p>Exemplo: Par&acirc;metros da requisi&ccedil;&atilde;o do tipo POST (formato arrayObject): &nbsp; &nbsp; &nbsp; &nbsp;<br><span style="color:#2F4F4F;">{<br> &quot;instancia&quot;:&quot;vendas-001&quot;<br>&nbsp;}</span></p>
<p>retorno(pode ser retornado dois valores &lsquo;inexistente&rsquo;(instancia n&atilde;o criada portanto n&atilde;o gerado qrcode) ou &lsquo;&rsquo;UNPAIRED&rsquo;(qrcode gerado por&eacute;m ainda n&atilde;o sincronizado) :<br><span style="color:#000080;">{<br> &quot;instancia&quot;: &quot;vendas-001&quot;,<br> &quot;status&quot;: &ldquo;UNPAIRED&rdquo;<br>&nbsp;}</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<address>&nbsp;</address>
